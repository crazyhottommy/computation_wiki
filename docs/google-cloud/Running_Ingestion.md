###Ingestion on CIDC-CLI portal (only for CIDC)
Users can use the automator for running the trial samples. After the runs are finished, the analysis results need to be transferred to the CIDC portal(https://portal.cimac-network.org/). This process is defined as ingestion.

In order to be able to do the ingestion, there are few requisites as mentioned below:
(i) Registered account on CIDC portal
(ii) Access to the trial and assay of interest on the CIDC production portal
(iii) Access to GCP
(iv) Ingestion spreadsheets *

   * Completed ingestion spreadsheets are usually generated by the Software team for each clinical trial.  Jen will distribute these to the team.  There are also templates available in the "Transfer Analyses" section of the CIDC-CLI portal.

After the users have completed all the prerequisites, they can proceed to the main section below which explains how to do the ingestion.
(i) Make sure you are logged in to your google cloud account on your local computer.  On your local computer terminal, run the below command.
  ```bash
   gcloud auth login --no-launch-browser
  ```
    The terminal will show a url, copy it and paste it into your browser.  Follow the instructions and then copy the key provided and paste it into your terminal window. This will allow you to use GCP command line tools from your local terminal.

(ii) Login to the GCP instance that stores the results from the runs.
  ```bash
     gcloud compute ssh --tunnel-through-iap [username]@[instance_name]
  ```

(iii) Transfer the ingestion spreadsheet provided by Jen to the instance.      
     In order to copy the ingestion spreadsheet to the VM instance, you need to be the owner of the /mnt/ssd directory.  On the instance, run the below commad.
  ```bash
     sudo chown -R <username>:<username> /mnt/ssd
  ```
     Next, transfer the ingestion spreadsheet from local computer to the VM instance. To do so, go to your local terminal and use the gcloud scp command as mentioned below.
  ```bash
     gcloud compute scp --tunnel-through-iap [ingestion_spreadsheet.xlsx] [username]@[instance_name]:/mnt/ssd
  ```
     e.g.
     gcloud compute scp --tunnel-through-iap CNKA2Q88X.01_template.xlsx jen@wes-auto-cnka2q88x:/mnt/ssd/

(iv) CIDC-CIMAC portal has further instructions on how to proceed ahead with ingestion. .
  ```bash
     Log into the production portal: https://portal.cimac-network.org/
     Go to the “Transfer Analyses” tab.
  ```
     The "Transfer Analyses" section has noted the instructions on cli command installation and usage of identity token. Please follow the steps mentioned  on the portal and then proceed to the next step.

 (v) WES specific ingestion
     Once you have successfully logged in to the cidc, run the transfer analyses command for WES.
     Run this command in the '/mnt/ssd/' directory.
     If the user has tumor-normal samples:
  ```bash
     cidc analyses upload --analysis wes_analysis --xlsx <ingestion_spreadsheet.xlsx>
  ```
     If the user has tumor-only samples:
  ```bash
     cidc analyses upload --analysis wes_tumor_only_analysis --xlsx <ingestion_spreadsheet.xlsx>
  ```

  (vi) CHIPS specific ingestion
      As of this writing (July 14. 2021) CHIPS (ATACseq) ingestion is not supported on the CIDC portal.  When this changes, look for specific information on the "Transfer Analyses" section of the CIDC portal.
     
  (vii) RIMA specific ingestion
     Once you have successfully logged in to the cidc, run the transfer analyses command for RIMA.
     Run this command in the '/mnt/ssd/' directory.
  ```bash
    cidc analyses upload --analysis rna_level1_analysis --xlsx <ingestion_spreadsheet.xlsx>
  ```      
