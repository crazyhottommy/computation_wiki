<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="computational wiki from Ming (Tommy) Tang"><link href=https://crazyhottommy.github.io/computation_wiki/kraken/kraken_rstudio/ rel=canonical><meta name=author content="Ming Tang"><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1, mkdocs-material-5.1.5"><title>Run Rstudio on Kraken - computation wiki</title><link rel=stylesheet href=../../assets/stylesheets/main.df84b5fe.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.8435c73a.min.css><meta name=theme-color content=#2196f3><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,400i,700%7CFira+Code&display=fallback"><style>body,input{font-family:"IBM Plex Sans",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Code",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../../assets/css/katex.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><link rel="preconnect dns-prefetch" href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=blue data-md-color-accent=blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#how-to-run-rstudio-server-on-kraken class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://crazyhottommy.github.io/computation_wiki/ title="computation wiki" class="md-header-nav__button md-logo" aria-label="computation wiki"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> computation wiki </span> <span class="md-header-nav__topic md-ellipsis"> Run Rstudio on Kraken </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/crazyhottommy/computation_wiki/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> crazyhottommy/computation_wiki </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://crazyhottommy.github.io/computation_wiki/ title="computation wiki" class="md-nav__button md-logo" aria-label="computation wiki"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> computation wiki </label> <div class=md-nav__source> <a href=https://github.com/crazyhottommy/computation_wiki/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> crazyhottommy/computation_wiki </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Computation Setup <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Computation Setup" data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Computation Setup </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../setup/setup_macos/ title="set up MacOS" class=md-nav__link> set up MacOS </a> </li> <li class=md-nav__item> <a href=../../setup/hpc-info/ title="set up HPC accounts" class=md-nav__link> set up HPC accounts </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3 checked> <label class=md-nav__link for=nav-3> Working with Kraken <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Working with Kraken" data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Working with Kraken </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../kraken_sshfs/ title="mount kraken folder to local computer" class=md-nav__link> mount kraken folder to local computer </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Run Rstudio on Kraken <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title="Run Rstudio on Kraken" class="md-nav__link md-nav__link--active"> Run Rstudio on Kraken </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#install-singularity-and-rocker class=md-nav__link> install singularity and Rocker </a> </li> <li class=md-nav__item> <a href=#set-up-local-library class=md-nav__link> set up local library </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../kraken_jupyter/ title="Run jupyter notebook" class=md-nav__link> Run jupyter notebook </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Working with Google Cloud <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Working with Google Cloud" data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Working with Google Cloud </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../google-cloud/getting-started-with-google-cloud.md title="Getting Started with gcp" class=md-nav__link> Getting Started with gcp </a> </li> <li class=md-nav__item> <a href=../../google-cloud/wes-gcp/ title="Run WES on gcp" class=md-nav__link> Run WES on gcp </a> </li> <li class=md-nav__item> <a href=../../google-cloud/wes-ingestion/ title="WES ingestion on gcp" class=md-nav__link> WES ingestion on gcp </a> </li> <li class=md-nav__item> <a href=../../google-cloud/chips-gcp/ title="Run CHIPS on gcp" class=md-nav__link> Run CHIPS on gcp </a> </li> <li class=md-nav__item> <a href=../../google-cloud/chips-automator/ title="Run CHIPS automator on gcp" class=md-nav__link> Run CHIPS automator on gcp </a> </li> <li class=md-nav__item> <a href=../../google-cloud/tcr-gcp/ title="Run TCR on gcp" class=md-nav__link> Run TCR on gcp </a> </li> <li class=md-nav__item> <a href=../../google-cloud/build-reference-snapshot/ title="Build Reference Snapshot" class=md-nav__link> Build Reference Snapshot </a> </li> <li class=md-nav__item> <a href=../../google-cloud/build-new-image/ title="Build Image" class=md-nav__link> Build Image </a> </li> <li class=md-nav__item> <a href=../../google-cloud/expand-partition/ title="Expand root partition" class=md-nav__link> Expand root partition </a> </li> <li class=md-nav__item> <a href=../../google-cloud/common-questions/ title="Common Q&amp;A" class=md-nav__link> Common Q&A </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> ATACseq pipeline <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="ATACseq pipeline" data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> ATACseq pipeline </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../atac/atac-bwa-reference/ title="Make bwa indices" class=md-nav__link> Make bwa indices </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> RIMA RNAseq pipeline <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="RIMA RNAseq pipeline" data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> RIMA RNAseq pipeline </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../RIMA/build-RIMA-reference/ title="Build RIMA references" class=md-nav__link> Build RIMA references </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> miscellaneous <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=miscellaneous data-md-level=1> <label class=md-nav__title for=nav-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> miscellaneous </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../miscellaneous/inkscape/ title="Making figures" class=md-nav__link> Making figures </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#install-singularity-and-rocker class=md-nav__link> install singularity and Rocker </a> </li> <li class=md-nav__item> <a href=#set-up-local-library class=md-nav__link> set up local library </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/crazyhottommy/computation_wiki/edit/master/docs/kraken/kraken_rstudio.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=how-to-run-rstudio-server-on-kraken>How to Run Rstudio server on kraken<a class=headerlink href=#how-to-run-rstudio-server-on-kraken title="Permanent link">&para;</a></h1> <h3 id=install-singularity-and-rocker>install singularity and Rocker<a class=headerlink href=#install-singularity-and-rocker title="Permanent link">&para;</a></h3> <p>Also read Ming Tang's blog post <a href=https://divingintogeneticsandgenomics.rbind.io/post/run-rstudio-server-with-singularity-on-hpc/ >https://divingintogeneticsandgenomics.rbind.io/post/run-rstudio-server-with-singularity-on-hpc/</a></p> <p>You can not run any jobs on the login node, even conda install is not allowed.</p> <p>First, submit an interactive job to get a node:</p> <div class=highlight><pre><span></span><code>ssh kraken
srun -t <span class=m>1600</span> --mem<span class=o>=</span>60G -c <span class=m>4</span> --pty bash
</code></pre></div> <p>From <code>man srun</code>:</p> <div class=highlight><pre><span></span><code>       --time-min=&lt;time&gt;
              Set a minimum time limit on the job allocation.  If specified, the job may have it&#39;s --time limit
              lowered to a value no lower than --time-min if doing so permits the job to begin  execution  ear‐
              lier  than  otherwise  possible.  The job&#39;s time limit will not be changed after the job is allo‐
              cated resources.  This is performed by a backfill scheduling algorithm to allocate resources oth‐
              erwise  reserved  for  higher  priority  jobs.   Acceptable time formats include &quot;minutes&quot;, &quot;min‐
              utes:seconds&quot;, &quot;hours:minutes:seconds&quot;, &quot;days-hours&quot;, &quot;days-hours:minutes&quot;  and  &quot;days-hours:min‐
              utes:seconds&quot;. This option applies to job allocations.
       -c, --cpus-per-task=&lt;ncpus&gt;
              Request  that  ncpus be allocated per process. This may be useful if the job is multithreaded and
              requires more than one CPU per task for optimal performance. The default is one CPU per  process.
              If  -c is specified without -n, as many tasks will be allocated per node as possible while satis‐
              fying the -c restriction. For instance on a cluster with 8 CPUs per node, a  job  request  for  4
              nodes and 3 CPUs per task may be allocated 3 or 6 CPUs per node (1 or 2 tasks per node) depending
              upon resource consumption by other jobs. Such a job may be unable to execute more than a total of
              4  tasks.   This option may also be useful to spawn tasks without allocating resources to the job
              step from the job&#39;s allocation when running multiple job steps with the --exclusive option.
       -N, --nodes=&lt;minnodes[-maxnodes]&gt;
              Request that a minimum of minnodes nodes be allocated to this job.  A maximum node count may also
              be specified with maxnodes.  If only one number is specified, this is used as  both  the  minimum
              and maximum node count.  The partition&#39;s node limits supersede those of the job.  If a job&#39;s node
              limits are outside of the range permitted for its associated partition, the job will be left in a
              PENDING  state.   This  permits  possible  execution at a later time, when the partition limit is
              changed.  If a job node limit exceeds the number of nodes configured in the  partition,  the  job
              will  be  rejected.  Note that the environment variable SLURM_JOB_NUM_NODES (and SLURM_NNODES for
              backwards compatibility) will be set to the count of nodes actually allocated to the job. See the
              ENVIRONMENT VARIABLES section for more information.  If -N is not specified, the default behavior
              is to allocate enough nodes to satisfy the requirements of the -n and -c options.  The  job  will
              be allocated as many nodes as possible within the range specified and without delaying the initi‐
              ation of the job.  If number of tasks is given and a number of requested nodes is also given  the
              number  of  nodes  used from that request will be reduced to match that of the number of tasks if
              the number of nodes in the request is greater than the number of tasks.  The node count  specifi‐
              cation  may  include  a  numeric  value  followed by a suffix of &quot;k&quot; (multiplies numeric value by
              1,024) or &quot;m&quot; (multiplies numeric value by 1,048,576). This option applies to job and step  allo‐
              cations.

       -n, --ntasks=&lt;number&gt;
              Specify  the  number of tasks to run. Request that srun allocate resources for ntasks tasks.  The
              default is one task per node, but note that the --cpus-per-task option will change this  default.
              This option applies to job and step allocations.}
</code></pre></div> <p>After you get a computing node, you will see the prompt becomes something like:</p> <p><code>(base) [mtang@node03 mtang]$</code>.</p> <p>Note, conda <code>singularity</code> has problems to run.</p> <p>Ask the admin to install <code>singularity</code> on the server instead. Luckily, it is on <code>kraken</code> already.</p> <div class=highlight><pre><span></span><code>module load singularity
</code></pre></div> <p>pull the rocker image. read <a href=https://www.rocker-project.org/use/singularity/ >https://www.rocker-project.org/use/singularity/</a></p> <div class=highlight><pre><span></span><code><span class=nb>cd</span> /liulab/mtang
mkdir singularity_images<span class=p>;</span> <span class=nb>cd</span> !$
singularity pull --name rstudio.simg docker://rocker/tidyverse
</code></pre></div> <p>To enable password authentication, set the PASSWORD environment variable and add the <code>--auth-none=0 --auth-pam-helper-path=pam-helper</code> options:</p> <div class=highlight><pre><span></span><code><span class=nv>PASSWORD</span><span class=o>=</span><span class=s1>&#39;xyz&#39;</span> singularity <span class=nb>exec</span> --bind<span class=o>=</span>/liulab/mtang  rstudio.simg rserver --auth-none<span class=o>=</span><span class=m>0</span>  --auth-pam-helper-path<span class=o>=</span>pam-helper  --www-address<span class=o>=</span><span class=m>127</span>.0.0.1
</code></pre></div> <p>This will run rserver in a Singularity container. The <code>--www-address=127.0.0.1</code> option binds to localhost (the default is <code>0.0.0.0</code>, or all IP addresses on the host). listening on <code>127.0.0.1:8787</code>.</p> <p>From your local workstation (e.g., mac book), ssh tunneling to the compute node.</p> <p>on your local mac:</p> <div class=highlight><pre><span></span><code><span class=c1># check which ports are open</span>
sudo lsof -i -P -n <span class=p>|</span> grep TCP
ssh -f -L <span class=m>59083</span>:localhost:59083 usrname@kraken.dfci.harvard.edu ssh -L <span class=m>59083</span>:localhost:8787 -N node03
</code></pre></div> <p>Go to your mac local browser, open <code>localhost:59083</code>, type your HPC username and <code>xyz</code> as the password in this dummy example. You should have a Rstudio server running!</p> <h3 id=set-up-local-library>set up local library<a class=headerlink href=#set-up-local-library title="Permanent link">&para;</a></h3> <p>You will want to install libraries so that the singularity container can use.</p> <p>If you go to your browser and inside Rstudio:</p> <div class=highlight><pre><span></span><code><span class=o>&gt;</span> <span class=nf>.libPaths</span><span class=p>()</span>
<span class=n>[1]</span> <span class=s>&quot;/usr/local/lib/R/site-library&quot;</span> <span class=s>&quot;/usr/local/lib/R/library&quot;</span> 
</code></pre></div> <p>You will see the library is pointing to the ones inside the container.</p> <p>Set up a <code>.Renviron</code> file in your HPC login node:</p> <div class=highlight><pre><span></span><code><span class=k>if</span> <span class=o>[</span> ! -e <span class=si>${</span><span class=nv>HOME</span><span class=si>}</span>/.Renviron <span class=o>]</span>
<span class=k>then</span>
  <span class=nb>printf</span> <span class=s1>&#39;\nNOTE: creating ~/.Renviron file\n\n&#39;</span>
  <span class=nb>echo</span> <span class=s1>&#39;R_LIBS_USER=~/R/%p-library/%v&#39;</span> &gt;&gt; <span class=si>${</span><span class=nv>HOME</span><span class=si>}</span>/.Renviron
<span class=k>fi</span>
</code></pre></div> <p>Now, go to Rstudio in the browser ---&gt; <code>Session</code>---&gt; <code>Restart R</code>.</p> <div class=highlight><pre><span></span><code><span class=o>&gt;</span> <span class=nf>.libPaths</span><span class=p>()</span>
<span class=n>[1]</span> <span class=s>&quot;/homes6/mtang/R/x86_64-pc-linux-gnu-library/3.6&quot;</span> <span class=s>&quot;/usr/local/lib/R/site-library&quot;</span>                  
<span class=n>[3]</span> <span class=s>&quot;</span><span class=err>/usr/local/lib/R/library</span>
</code></pre></div> <p>You now see that <code>"/homes6/mtang/R/x86_64-pc-linux-gnu-library/3.6"</code> is my local library. If I install packages inside Rstudio, it will be installed there.</p> <p><strong>Note</strong>:</p> <p>The <code>.rstudio</code> in your home directory <code>/homes6/mtang/.rstudio/sessions/active/session-2cf8e174/suspended-session-data</code> can grow large. Remember to clean it up (delete) it regularly.</p> <hr> <div class=md-source-date> <small> Last update: July 23, 2020 </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../kraken_sshfs/ title="mount kraken folder to local computer" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> mount kraken folder to local computer </div> </div> </a> <a href=../kraken_jupyter/ title="Run jupyter notebook" class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Run jupyter notebook </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 <a href=https://divingintogeneticsandgenomics.rbind.io/ >Ming Tang</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.83fe6e3c.min.js></script> <script src=../../assets/javascripts/bundle.7e1cb91c.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> <script src=../../assets/js/katex.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script> </body> </html>